<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Ionosphere Queues</title>
  
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  <!-- Optional theme -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

  <style>
    table {
      width: 100%;
      table-layout: fixed;
      margin: 5px;
    }
    td {
      overflow-wrap: break-word;
      vertical-align: top;
    }
    td, th {
      padding: 10px;
    }
  </style>

  <!-- Latest compiled and minified jQuery -->
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>

  <!-- Latest compiled and minified Bootstrap JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>  

  <!-- Latest compiled and minified moment.js JavaScript -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"  crossorigin="anonymous"></script>  

</head>

<body id="home">
  
  <div class="panel panel-default">
    <div class="panel-heading">Queued Messages</div>

    <table id="table">
        <thead>
            <tr>              
                <th class="created_at">Created</th>
                <th class="bid">Bid (msatoshis)</th>
                <th class="message">Message</th>
                <th class="message_digest">Message Digest</th>
                <th class="status">Status</th>
                <th class="upload_started_at">Upload Started</th>
                <th class="upload_ended_at">Upload Ended</th>
            </tr>
        </thead>
    </table>
  </div>

  <script type="text/javascript">
    $(function() {
      $.getJSON( "queue", function( data ) {
        $.each( data, function( key, val ) {
          var upload_started_at = moment(val.upload_started_at);
          var upload_ended_at = moment(val.upload_ended_at);
          $("#table").append($('<tr>').append(
                $('<td>').text(moment(val.created_at).fromNow()),
                $('<td>').text(val.bid),
                $('<td>').text(val.message),
                $('<td>').text(val.message_digest),
                $('<td>').text(val.status),
                $('<td>').text(upload_started_at.isValid() ? upload_started_at.fromNow() : ""),
                $('<td>').text(upload_ended_at.isValid() ? upload_ended_at.fromNow() : "")
          ));
        });
      });
    });
  </script>    

</body>
</html>
